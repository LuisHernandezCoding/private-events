<div class="columns is-multiline is-size-6-fullhd	is-size-7-desktop is-size-7-tablet is-size-7-mobile">
  <div class="column is-4-desktop is-12-mobile">
    <div class="card events-card">
      <header class="card-header">
        <p class="card-header-title">
          User Information
        </p>
      </header>
      <div class="card-table">
        <div class="content">
          <table class="table is-fullwidth is-striped">
            <tbody>
              <tr>
                <td width="5%"><i class="fa fa-envelope"></td>
                <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">Email</td>

                <td class="level-right is-hidden-mobile break-anywhere"><%= @profile.user.email.downcase %></td>
                <td class="level-right is-hidden-tablet"><%= @profile.user.email.downcase.truncate(20) %></td>

              </tr>
              <% if owner? %>
                <tr>
                  <td width="5%"><i class="fa fa-check"></td>
                  <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">2FA</td>
                  <td class="level-right">
                    <% if @profile.user.otp_required_for_login %>
                      <a class="button is-small is-primary" href="<%= users_otp_settings_path %>">Activated</a>
                    <% else %>
                      <a class="button is-small is-danger" href="<%= users_otp_settings_path %>">Desactivated</a>
                    <% end %>
                  </td>
                </tr>
                <tr>
                  <td width="5%"><i class="fa fa-arrow-circle-right"></td>
                  <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">Setup</td>
                  <td class="level-right">
                    <% if @profile.profile_state == "completed" %>
                      <div class="button is-small is-primary">Complete</div>
                    <% elsif @profile.profile_state == "created" %>
                      <a class="button is-small is-danger" href="<%= edit_profile_interests_path(@profile.username) %>">Step 2/4</a>
                    <% elsif @profile.profile_state == "interested" %>
                      <a class="button is-small is-danger" href="<%= country_path(@profile.username) %>">Step 3/4</a>
                    <% elsif @profile.profile_state == "located" %>
                      <a class="button is-small is-danger" href="<%= users_otp_ask_path(@profile.username) %>">Step 4/4</a>
                    <% end %>
                  </td>
                </tr>
                <% if @profile.profile_state != "completed" %>
                  <tr>
                    <td colspan="3" class="has-text-centered">
                      <% if @profile.profile_state == "created" %>
                        <a href="<%= edit_profile_interests_path(@profile.username) %>">
                          <progress class="progress is-primary" value="45" max="100"></progress>
                        </a>
                      <% elsif @profile.profile_state == "interested" %>
                        <a href="<%= country_path(@profile.username) %>">
                          <progress class="progress is-primary" value="70" max="100"></progress>
                        </a>
                      <% elsif @profile.profile_state == "located" %>
                        <a href="<%= users_otp_ask_path(@profile.username) %>">
                          <progress class="progress is-primary" value="90" max="100"></progress>
                        </a>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <% if owner? %>
        <footer class="card-footer">
          <a href="<%= users_otp_settings_path %>" class="card-footer-item">2FA Settings</a>
          <a href="<%= edit_user_registration_path %>" class="card-footer-item">Edit</a>
        </footer>
      <% end %>
    </div>
    <br>
    <% if @profile.public_profile || owner? %>
      <div class="card events-card">
        <header class="card-header">
          <p class="card-header-title">
            Personal Information
          </p>
        </header>
        <div class="card-table">
          <div class="content">
            <table class="table is-fullwidth is-striped">
              <tbody>
                <tr>
                  <td width="5%"><i class="fa fa-user"></td>
                  <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">Username</td>
                  <td class="level-right"><%= @profile.username %></td>
                </tr>

                <% if @profile.public_profile || owner? %>
                  <tr>
                    <td width="5%"><i class="fa fa-pen-nib"></td>
                    <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">Full name</td>
                    <td class="level-right"><%= @profile.first_name %> <%= @profile.last_name %></td>
                  </tr>
                  <% if @profile.city.present? %>
                    <tr>
                      <td width="5%"><i class="fa fa-city"></td>
                      <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">City</td>
                      <td class="level-right"><%= @profile.city %></td>
                    </tr>
                  <% end %>
                  <% if !@profile.birthday.nil? %>
                    <tr>
                      <td width="5%"><i class="fa fa-calendar"></td>
                      <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">Birthday</td>
                      <td class="level-right"><%= @profile.birthday %></td>
                    </tr>
                  <% end %>
                <% end %>

                <% if owner? %>
                  <tr>
                    <td width="5%"><i class="fa fa-lock"></td>
                    <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left">Privacity:</td>
                    <td class="level-right">
                      <% if @profile.public_profile %>
                        <%= button_to "Public", privacity_path, method: :patch, class: "button is-small is-primary" %>
                      <% else %>
                        <%= button_to "Private", privacity_path, method: :patch, class: "button is-small is-info" %>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
        <% if owner? %>
          <footer class="card-footer">
            <a href="<%= edit_profile_path %>" class="card-footer-item">Edit</a>
          </footer>
        <% end %>
      </div>
    <% else %>
      <div class="box">
        <p class="title is-5">This profile is private!</p>
        <p class="subtitle is-6">Only authorized users can see this content.</p>
      </div>
    <% end %>
  </div>
  <div class="column is-8">
    <% if owner? %>
      <section class="hero is-info welcome is-small">
        <div class="hero-body">
          <div class="container columns is-multiline">
            <div class="column is-half">
              <h1 class="title has-text-left">
                Hello, <%= @profile.first_name %>!
              </h1>
              <h2 class="subtitle has-text-left">
                I hope you are having a great day!
              </h2>
            </div>
            <% if @profile.profile_state != "completed" %>
              <div class="column is-half notification is-warning is-centered">
                <p>Please complete your profile to be able to create events.</p>
                <br>
                <% if @profile.profile_state == "created" %>
                  <p class="has-text-centered has-text-weight-bold is-size-5 has-text-info">
                    Setp 2: Edit your interests
                  </p>
                  <br>
                  <a href="<%= edit_profile_interests_path(@profile.username) %>" class="button is-primary is-pulled-right">Continue</a>
                <% elsif @profile.profile_state == "interested" %>
                  <p class="has-text-centered has-text-weight-bold is-size-5 has-text-info">
                    Step 3: Edit your location
                  </p>
                  <br>
                  <a href="<%= country_path(@profile.username) %>" class="button is-primary is-pulled-right">Continue</a>
                <% elsif @profile.profile_state == "located" %>
                  <p class="has-text-centered has-text-weight-bold is-size-5 has-text-info">
                    Step 4: Edit your 2FA settings
                  </p>
                  <br>
                  <a href="<%= users_otp_ask_path(@profile.username)%>" class="button is-primary is-pulled-right"> Continue </a>
                <% end %>
                <%= button_to "Skip", next_step_path(@profile.username), method: :patch, class: "button is-pulled-left" %>
                <br>
              </div>
            <% end %>
          </div>
        </div>
      </section>
      <br>
    <% end %>
    <section class="info-tiles">
      <div class="tile is-ancestor has-text-centered">
        <div class="tile is-parent">
          <article class="tile is-child box">
            <p class="title">0</p>
            <p class="subtitle">Assisted Events</p>
          </article>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child box">
            <p class="title">0</p>
            <p class="subtitle">Created Events</p>
          </article>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child box">
            <p class="title">0</p>
            <p class="subtitle">Upcoming Events</p>
          </article>
        </div>
      </div>
    </section>
    <br>
    <h1 class="title is-5 has-text-left">
      Interests
      <% if owner? %>
        <span class="has-text-grey-light is-size-7"> (Click to remove)</span>
        <a class="button is-small is-info is-pulled-right" href="<%= edit_profile_interests_path(@profile.username) %>">
          Edit Interests &nbsp &nbsp
          <i class="fa fa-edit"></i>
        </a>
      <% end %>
    </h1>
    <table class="table is-fullwidth is-striped">
      <% if @profile.public_profile || owner? %>
        <tbody>
          <% @profile.categories.order(:name).uniq.each do |category| %>
            <tr>
              <td width="25%" class="has-text-weight-bold has-text-grey-dark has-text-left mt-1"><%= category.name %></td>
              <td width="80%" class="has-items-right">
                <div class="columns is-multiline mt-1 mb-1 is-flex">
                  <% @profile.interests.where(category_id: category.id).each do |interest| %>
                    <% if owner? %>
                      <%= button_to destroy_profile_interests_path({username: @profile.username, interest_id: interest.id}), method: :delete, class: "button is-small is-info m-1" do %>
                          <%= interest.name %> &nbsp; <i class="fa fa-times"></i>
                      <% end %>
                    <% else %>
                      <div class="button is-small is-info m-1"><%= interest.name %></div>
                    <% end %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>   
      <% else %>
        <div class="box">
          <p class="title is-5">This profile is private!</p>
          <p class="subtitle is-6">Only authorized users can see this content.</p>
        </div>
      <% end %>
    </table>
  </div>
</div>